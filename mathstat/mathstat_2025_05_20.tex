$subject$=Математическая статистика
$teacher$=Лекции Блаженова А. В.
$date$=20.05.2025

\section{Лекция 15.}

\subsection{Метод Монте-Карло}

\hypertarget{monte_carlo}{}

Метод Монте-Карло появился в статье Метрополиса и Улама и был назван в честь района Монте-Карло в Монако, где были расположены элитные казино


Общая постановка задачи: пусть требуется найти неизвестное число $a$ и при этом имеется случайная величина $\xi$ такая, что $E \xi = a$. Тогда по Закону Больших Чисел $\frac{\xi_1 + \dots + \xi_n}{n} \ConvergesInProbability a$ -- то есть при длинном разыгрывании $a^* = \frac{S_n}{n}$

Оценим погрешность метода: если $D\xi_1 < \infty$, то по ЦПТ $\frac{(\xi_1 + \dots + \xi_n) - n a}{\sqrt{n D \xi_1}} = \frac{n \overline{x} - na}{\sqrt{n D\xi_1}} = \frac{n(\overline{x} - a)}{\sqrt{n D\xi_1}} = \sqrt{n} \frac{\overline{x} - a}{\sqrt{D\xi_1}} \rightrightarrows N(0, 1)$

По правилу \enquote{трех сигм} $P\left(\left|\sqrt{n} \frac{\overline{x} - a}{\sqrt{D\xi_1}}\right| < 3\right) \underset{n \to \infty}{\longrightarrow} 0.9973 \approx 1 \Longrightarrow \sqrt{n} \frac{|\overline{x} - a|}{\sqrt{D \xi_1}} < 3 \Longrightarrow \delta = |\overline{x} - a| < \frac{3\sqrt{D\xi_1}}{\sqrt{n}}$

\Nota То есть скорость сходимости в методе Монте-Карло порядка $\sqrt{n}$ -- довольно медленная, поэтому метод Монте-Карло применяется в ситуации, не требующих высокой точности, где допустима погрешность $5\%$

\subsubsection{Вычисление интегралов}

\Mem $\int_a^b \varphi(x) dx = \lim_{\Delta x \to 0} \sum_{i = 1}^n \varphi(x_i) \Delta x_i$, где $\Delta x_i$ -- длины отрезков разбиения $A_i = [a_i, a_{i + 1}]$, а $x_i \in A_i$

На этом определении построены квадратурные формы:

\begin{enumerate}[label*=\Roman*. ]
    \item Метод прямоугольников

    Отрезок от $a$ до $b$ разбивается на $n$ равных частей $A_i = [a_i, a_{i + 1}]$, $i = 0, 1, \dots, n - 1$

    $x_i = \frac{a_i + a_{i + 1}}{2}$ -- середина интервала

    Тогда $I = \int_a^b \varphi(x) dx \approx \frac{b - a}{n} (y_0 + \dots + y_{n - 1}) = I_n$, где $y_i = \varphi(x_i)$

    Погрешность $|I - I_n| \leq \frac{M_1}{n^2}$, где $M_1$ -- некая константа, зависящая от функции и длины интервала

    \item Формула трапеций

    Идея состоит в том, чтобы вместо площади прямоугольников считать площади трапеций. Отрезок также разбивается на $n$ равных частей

    $y_i = \varphi(x_i)$

    $I = \int_a^b \varphi(x) dx \approx \frac{b - a}{2n} (y_0 + y_n + 2(y_1 + y_2 + \dots + y_{n - 1})) = I_n$

    Здесь погрешность $|I - I_n| < \frac{M_2}{n^2}$, где $M_2 = \frac{M_1}{2}$

    \item Формула Симпсона или формула парабол

    Здесь вместо трапеций будем использовать площадь под параболой, проходящей через 3 точки

    $[a, b]$ разбивается на $n = 2m$ -- четное число равных отрезков

    $I = \int_a^b \varphi(x) dx \approx \frac{b - a}{3n} (y_0 + y_n + 4(y_1 + y_3 + \dots + y_{n - 1}) + 2(y_2 + y_4 + \dots + y_{n - 2})) = I_n$

    Погрешность $|I - I_n| \leq \frac{M_3}{n^4}$ -- намного лучше, чем у предыдущих двух

    \hypertarget{monte_carlo_integral}{}

    \item Метод Монте-Карло

    $I = \int_a^b \varphi(x) dx$

    Так как можно привести отрезок $[a, b]$ к $[0, 1]$ при помощи линейной замены $\frac{x - a}{b - a}$, то ограничимся интегралом $I = \int_0^1 \varphi(x) dx$

    Имеем датчик $\eta_i \in U(0, 1)$, $f_{\eta} (x) = 1, x \in [0, 1]$

    Пусть $\xi_i = \varphi(\eta_i)$, тогда $E\xi_i = \int_{-\infty}^{\infty} \varphi(y) f_\eta (y) dy = \int_0^1 \varphi(y) dy = I$. 
    
    Поэтому $I \approx I_n = \frac{1}{n} \sum_{i = 1}^n \xi_i = \frac{1}{n} (\varphi(\eta_1) + \dots + \varphi(\eta_n))$

    При этом оценка погрешности будет $|I - I_n| \leq \frac{3\sqrt{D \xi_1}}{\sqrt{n}}$, где $D \xi_1 = \int_0^1 \varphi^2(y) dy - I^2$

    Недостатки: медленная скорость сходимости; для оценки погрешности надо оценить дисперсию $D\xi_i$; оценка справедлива лишь с вероятностью

    Поэтому метод Монте-Карло не применяется

\end{enumerate}

\subsubsection{Метод Монте-Карло в кратных интегралах}

\hypertarget{monte_carlo_k_integral}{}

\Nota При вычислении $k$-кратных интегралов при помощи квадратурных формул число узлов быстро возрастает как $n^k$, при этом скорость сходимости при больших $k$ будет $\frac{1}{n^{1 + \varepsilon}}$, где $\varepsilon$ - малое число больше 0. А метод Монте-Карло по-прежнему дает скорость сходимости $\frac{1}{\sqrt{n}}$, при этом всего лишь достаточно набросать $n$ случайных точек в данную область

$I = \iint \dots \int_D \varphi(x_1, x_2, \dots, x_k) dx_1 dx_2 \dots dx_k$

По методу Монте-Карло $I \approx \frac{1}{n} \sum_{i = 1}^n \varphi(y_1, \dots, y_k) \cdot I_D$, где $y_1, \dots, y_n$ - значения датчика случайных чисел, а $I_D$ - индикатор, который равен 1, если $(y_1, \dots, y_k) \in D$ (считаем, что $D \subset [0, 1]^k$, а $(y_1, \dots, y_k) \in [0, 1]^k$) 

\Ex Вычислим площадь четверти круга $x^2 + y^2 = 1, x \geq 0, y \geq 0$

Тогда генерируем случайные точки в квадрате $[0, 1]^k$, получаем $n$ точек, из которых $n_D$ входит в круг. Тогда площадь четверти $S_D = \frac{\pi}{4} \approx \frac{n_D}{n} \Longrightarrow \pi = \frac{4}{n_D}{n}$

\subsection{Метод Монте-Карло расслоенной выборки}

\hypertarget{monte_carlo_2}{}

Пусть $I = \int_0^1 \dots \int_0^1 \varphi(x_1, \dots, x_k) dx_1 \dots dx_k$

Каждую из сторон куба разобьем на $N$ равных частей, тогда куб разобьется на $n = N^k$ равных кубиков. В каждом из этих кубиков возьмем случайную точку $\eta_i = (\eta_i^{(1)}, \dots, \eta_i^{(k)})$, $1 \leq i \leq n$

Тогда $I \approx I_n = \frac{1}{n} \sum_{i = 1}^n \varphi(\eta_i)$

При этом методе погрешность будет лучше: $|I - I_n| \leq \frac{C}{n^{\frac{1}{2} + \frac{1}{k}}}$

Например, при $I = \int_0^1 \varphi(x) dx$ погрешность $|I - I_n| \leq \frac{C}{n^\frac{3}{2}}$

\subsection{Равномерность по Вейлю}

\Def Числовая последовательность $x_1, x_2, \dots, x_n, \dots, x_i \in [0, 1]$ называется равномерной по Вейлю, если частота попадания точек на любой отрезок $[a, b] \subset [0, 1]$ стремится к его длине $\frac{b - a}{1}$

В частности значения случайной величины $\xi \in U(0, 1)$ обладают данным свойством согласно Закону Больших Чисел, как и значения датчиков случайных чисел 

\begin{MyTheorem}
    \Ths Пусть $x_n = \{n \cdot \alpha\}$ -- дробная часть, где $\alpha$ -- иррациональное число. Тогда последовательность $x_n$ является равномерной по Вейлю
\end{MyTheorem}

Если $x_n$ равномерна по Вейлю, то $I_n = \frac{1}{n} \sum_{i = 1}^n \varphi(x_i) \longrightarrow I = \int_0^1 \varphi(x) dx$

\Nota Но если $x_n$ равномерна по Вейлю, то возможно, что $I_n = \frac{1}{n} \sum_{i = 1}^n \varphi(x_i, x_{i + 1}) \not\longrightarrow I = \int_0^1 \int_0^1 \varphi(x, y) dx dy$, так как соседние члены последовательности будут не такими случайными, как в датчике случайных чисел 

\Def Числовая последовательность $x_1, \dots, x_n$, $x_i \in [0, 1]$ называется вполне равномерной, если для любого $k \in \Natural$ частота попадания $k$-мерных точек $(x_{(n - 1) k + 1}, \dots, x_{nk})$ в любой $k$-мерный параллелепипед внутри $[0, 1]^k$ стремится к объему параллелепипеда

\begin{MyTheorem}
    \Ths Чемпернауна

    Для числа $0.1234567891011121314151617\dots$ подпоследовательность цифр будет вполне равномерной (то есть каждая последовательность чисел встречается примерно так же часто, как и все другие последовательности чисел той же длины)
\end{MyTheorem}

Парадокс первой цифры: являются ли все первые цифры в записи числа $2^n$ равновероятными

Пусть $m = 1, 2, 3, \dots, 9$ равновероятны ($p = \frac{1}{9}$)

Пусть $m$ - первый цифра $2^n$. Тогда $m \cdot 10^l \leq 2^n < (m + 1) \cdot 10^l$

Прологарифмируем: $l + \log_{10} m \leq n \log_{10} 2 < l + \log_{10} (m + 1)$

$\log_{10} m \leq \{n \log_{10} 2\} < \log_{10} (m + 1)$

Число $\{n \log_{10} 2\}$ -- иррациональное, поэтому последовательность будет равномерной по Вейлю, поэтому $p(m) = \log_{10} (m + 1) - \log_{10} m = \log_{10} \left(1 + \frac{1}{m}\right)$

Например, при $m = 7, p(7) \approx 0.058 \neq \frac{1}{9}$
