## Лекция 4. Коммутаторы сетей Ethernet

Цель неуправляемого коммутатора, описанного ранее, - разделить домен коллизий при обеспечении связности узлов, подключенных к нему

Если домен коллизий меньше, то с меньшей вероятностью она случается, тем самым не занимая время канала на ожидание

Топология сети, построенной на неуправляемых коммутаторах, должна представлять собой односвязный граф. На такой сети отлично работает широковещательная трансляция 

Однако, если подсоединить два каких-то коммутаторов и отправить пакет, то этот пакет из одного коммутатора перейдет к другому, потом к самому же себе через другой путь и отправлен заново, то есть дублирован в сети

Неконтролируемое дублирование широковещательного сигнала называется широковещательным штормом

![Широковещательный шторм](images/telecomm_broadcast_storm.png)

Поэтому для построения топологически сложных сетей нужно что-то более хитрое, чем простой коммутатор

---

Сетевой адаптер - ключевое устройство для доступа вычислительного узла к сети. Он характеризуется:

* Количеством портов, шиной
* PXE (Preboot eXecution Environment) - способность загружать через сеть операционную систему без использования накопителя
* WoL (Wake-on-LAN) - способность удаленно включать устройство через отправку в локальную сеть специальную последовательность байтов (так называемый magic packet)
* RDMA (Remote Direct Memory Access) - доступ к оперативной памяти узла через сеть
* VMMQ (Virtual Machine Multiple Queue) - масштабирование обработки трафика для виртуальных машин
* Поддержка VLAN - виртуальных локальных сетей
* GreenEthernet - экономия электроэнергии во время неиспользования адаптера

Концентраторы, повторители и медиаконверторы:

* работают на физическом уровне (например, медиаконвертер преобразует оптический сигнал в электрический)
* не имеют фильтрации, обработки, только усиливают или преобразуют сигнал
* не ограничивают широковещательные сообщения

Коммутаторы работают на более высоком уровне:

* Коммутатор L2 (второго уровня) работает на канальном уровне

    Поступающий на порт коммутатора кадр записывается только в тот порт, к которому подключено устройство с адресом назначения. Остальные порты коммутатора свободны и могут участвовать в обмене данными между друг другом. В случае, если в таблице нет данных об адресе назначения, кадр записывается во все порты устройства. Адресная информация в заголовке кадра канального уровня не изменяется

* Коммутатор L3 (третьего уровня) работает на сетевом уровне

    Он может работать в режиме коммутатора второго уровня. В режиме коммутатора третьего уровня осуществляет маршрутизацию, то есть передает пакеты на основании таблиц маршрутизации. В большинстве случаев работает быстрее маршрутизатора

    Также коммутатор L3 может фильтровать трафик

При этом маршрутизатор (или роутер) объединяет узлы на сетевом уровне, использую адресную информацию в заголовке сетевого уровня. При получении кадр раскрывается до содержимого на сетевом уровне, а затем заново упаковывается, используя другие адреса сетевого уровня

Коммутатор L3 нельзя полностью считать роутером, так как роутер способен работать с разными канальными протоколами и иметь более сложные функции (например, VPN)

Коммутаторы делятся также по конструкции: настольные, стоечные (rack mount, 19 дюймов в ширину), промышленные (на din-рейку). Коммутаторы могут иметь слоты расширения, например, по стандарту GBIC (Gigabit Interface Converters) или SFP (Small Form-factor Pluggable)

Коммутатор характеризуется:

* скоростью фильтрации (filtering)
* скоростью пересылки (forwarding)
* пропускной способностью (throughput)
* задержкой передачи кадра
* размером буфера (буферов) кадров
* производительностью внутренней шины
* производительностью процессора или процессоров 
* размером внутренней адресной таблицы

Скорость коммутатора могут ограничивать:

* Аппаратные характеристики
* Ограничение протокола
* Преодоление ограничений протокола, например, сокращение межпакетного интервала или метод обратного давления (эмуляция коллизий в случае переполнения буфера для его разгрузки)

---

Помимо коммутации коммутатор также может:

* Auto-MDIX - определение типа кабеля и автоматическая настройка пар контактов для передачи и приема
* Стандарт IEEE 802.3u определяет протокол, который позволяет двум узлам Ethernet на основе витой пары договариваться таким образом, что бы они одновременно использовали одинаковую скорость и параметры дуплекса (параметр кабеля, half-duplex значит, что канал работает только в одну любую сторону в какой-то момент времени, full-duplex - в две стороны)
* Объединение в стек - технология, которая позволяет физически соединить несколько отдельных коммутаторов и управлять ими как единым логическим устройством
* Агрегация каналов (Link Aggregation) - технология объединения нескольких физических сетевых соединений в одно логическое для увеличения пропускной способности и обеспечения отказоустойчивости
* Зеркалирование портов (Port Mirroring) - функция сетевых коммутаторов, которая позволяет копировать весь сетевой трафик с одного или нескольких портов и перенаправлять его на другой специальный порт для анализа
* Технология PoE (Power over Ethernet, стандарты IEEE 802.3af-2003, IEEE 802.3at-2009 и IEEE 802.3bt-2018) позволяет передавать энергию для маломощных устройств по витой паре до 15.4 Вт
* Протоколы STP (Spanning Tree Protocol, стандарт IEEE 802.1d) и RSTP (Rapid Spanning Tree Protocol, стандарт IEEE 802.1w) позволяют из сложной топологии графа сети делать остовное дерево путем оценки весов соединений между коммутаторами и запрета дальнейшей передачи трафика по невыбранным ребрами, тем самым избегая широковещательного шторма
* Функции безопасности (фильтрация многоадресных рассылок, фильтрация по MAC-адресам и IP, IEEE 802.1x и другое)
* Виртуальные локальные сети (VLAN)

    Они делятся на VLAN на базе MAC, VLAN на базе порта и VLAN на базе тега (стандарт IEEE 802.1q) - в кадре Ethernet между адресом отправителя и Ethertype записывается тег виртуальной локальной сети

    В коммутаторах Cisco для этого есть два типа портов: Trunk отвечает за передачу кадров с тегами, а Access - за передачу без тегов конечным потребителям

![Возможности коммутатора](images/telecomm_commutators_skills.png)

Также коммутаторы делятся на:

* _Коммутаторы доступа или рабочих групп_ - коммутаторы, соединяющие рабочие станции
    На этом уровне возможны угрозы: DHCP-snooping - получение адреса неизвестного DHCP-сервера; IP-spoofing - подмены IP-адреса источника; ARP-spoofing - перехвата трафика; подмены MAC-адресов
* _Коммутаторы распределения_ объединяют уровни доступа и предоставляют доступ к различным сервисам организации, осуществление маршрутизации трафика между VLAN
* _Коммутаторы ядра сети_ - объединяют уровни распределения в больших сетях

Они отражают уровни иерархии коммутаторов



